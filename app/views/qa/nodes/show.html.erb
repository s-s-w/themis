<div class='row'>
	<div class='small-6 column'>
		<p><%= link_to 'trees', trees_path %></p>
	</div>
	
	<div class='small-6 columns' style='text-align:right;'>
		<p>
			<%= link_to 'expand all', js_void, onclick: "expandAll()" %>
			<%= divider %>
			<%= link_to 'collapse all', js_void, onclick: "collapseAll()" %>
			<br />
			<%= archived_link_for @node %>
		</p>
	</div>
</div>

<%= render 'tree', node: @node.root, selected: @node -%>

<h1><%= type_for(@node).titleize %></h1>
<%= render 'node', node: @node, id_or_class: 'id' -%>

<% @node.valid_ordered_child_classes.each do |child_class| -%>
	<% nodes = @node.ordered_children_for child_class.name -%>
	
	<% unless nodes.empty? -%>
		<% unless 'subtype' == type_for(child_class) -%>
			<h2><%= type_for(child_class).titleize.pluralize %></h2>
		<% end -%>
		
		<%= render 'list', collection: nodes, list_type: :ol -%>
	<% end -%>
<% end -%>

<br>
<br>
<br>

<a name='form'>
	<h2>New Response</h2>
</a>

<div class='form'>
	<%= render 'form', node: @node.children.build -%>
</div>


<script>
	//function toggleExpanded(selector) {
	//	$(selector).each( function(i, el) {
	//		if( el.className.search('expanded') != -1 ) {
	//			el.className = el.className.replace('branch_header expanded', 'branch_header');
	//		} else {
	//			el.className = el.className.replace('branch_header', 'branch_header expanded');
	//		}
	//	});
	//}
	
	function expandAll() {
		$('.branch_body_text').show(1000);
		toggleExpanded('.branch_header');
	}
	
	function collapseAll() {
		$('.branch_body_text').hide(1000);
		toggleExpanded('.branch_header');
		
		$('.response').css('display', 'visible');
	}
	
	function toggleVisibility(selector) {
		if( $(selector).css('display') === 'none' ) {
				$(selector).show(400);
		} else
			{ $(selector).hide(400); }
	}
	
	function toggleExpanded(selector) {
		if( $(selector)[0].className.search('expanded') != -1 ) {
			$(selector).animate({ height : '25px' }, 400, function () {
	 			$(selector)[0].className = $(selector)[0].className.replace('branch_header expanded', 'branch_header');
			});
		}
		else {
			$(selector).animate({ height : '100%' }, 400, function () {
				$(selector)[0].className = $(selector)[0].className.replace('branch_header', 'branch_header expanded');
			});
		}
	}
	
	function toggleBodyTextVisibility(selector) {
		var branch_body_text_id = selector.replace('#', '#branch_body_text_');
		var branch_header_id 		= selector.replace('#', '#branch_header_');
		
		toggleVisibility(branch_body_text_id);
		toggleExpanded(branch_header_id);
	}
</script>